#!/usr/bin/env bash

docker-compose version

docker-compose down --rmi local --remove-orphans
docker volume create --name=sentry-clickhouse
docker volume create --name=sentry-data
docker volume create --name=sentry-kafka
docker volume create --name=sentry-postgres
docker volume create --name=sentry-redis
docker volume create --name=sentry-symbolicator
docker volume create --name=sentry-zookeeper

cd relay
cp config.example.yml config.yml
rm credentials.json
cd ..

creds="docker-compose run --no-deps relay credentials"
ls -FGl relay
$creds generate --stdout 2> stderr > credentials.json.tmp

echo 'stderr ----------------------------------'
cat stderr
echo 'ls relay --------------------------------'
ls -FGl relay
echo 'creds show ------------------------------'
$creds show
echo 'moving ----------------------------------'
mv credentials.json.tmp relay/credentials.json
ls -FGl relay
echo 'relay/credentials.json ------------------'
cat relay/credentials.json
echo '========================================='
$creds show 
